<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
        <title>Media Player Integration</title>
    
    
    <link rel="stylesheet" href="../theme/bootstrap.min.css" />
    <link rel="stylesheet" href="../theme/pygments.css" />
    <link rel="stylesheet" href="../theme/main.css" />
    
    
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="../theme/jquery.min.js"></script>
    <script src="../theme/bootstrap.min.js"></script>
    
  </head>
  <body>
    <nav class="navbar navbar-default navbar-static-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">Nuvola Player Documentation</a>
    </div><!-- .navbar-header -->

    <div class="collapse navbar-collapse" id="navbar-collapse-1">
  <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../core.html">Core</a></li>
            <li class="dropdown">
              <a href="../apps.html" class="dropdown-toggle" data-toggle="dropdown">Service Integrations <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li class="divider"></li>
                <li class="dropdown-header">Basic</li>
                <li><a href="../apps.html">Introduction</a></li>
                <li><a href="../apps/api_reference.html">NuvolaKit 3.0 JavaScript API Reference</a></li>
                <li><a href="../apps/tutorial.html">Service Integration Tutorial</a></li>
                <li><a href="../apps/mediaplayer.html">Media Player Integration</a></li>
                <li><a href="../apps/guidelines.html">Service Integration Guidelines</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">Advanced</li>
                <li><a href="../apps/url-filtering.html">URL Filtering (URL Sandbox)</a></li>
                <li><a href="../apps/configuration-and-session-storage.html">Configuration and session storage</a></li>
                <li><a href="../apps/initialization-and-preferences-forms.html">Initialization and Preferences Forms</a></li>
                <li><a href="../apps/variable-home-page-url.html">Web apps with a variable home page URL</a></li>
                <li><a href="../apps/custom-actions.html">Custom Actions</a></li>
                <li><a href="../apps/translations.html">Translations</a></li>
              </ul>
            </li>
          </ul>
</div><!-- .navbar-collapse -->
  </div>
</nav>
    
    <div class="container">
      <div class="row">
        
        
  <div class="col-sm-12">
      <div class="page-header text-center">
        <h1 id="top">Media Player Integration</h1>
      </div>
  </div>
  <div class="col-md-2 col-lg-3 sidebar">
    
      <p><strong>Contents</strong></p>
      <div class="toc">
<ul>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#metadata">Metadata</a></li>
<li><a href="#integration-script">Integration Script</a><ul>
<li><a href="#media-player-skeleton">Media player skeleton</a></li>
<li><a href="#playback-state">Playback state</a></li>
<li><a href="#track-details">Track details</a></li>
<li><a href="#media-player-actions">Media Player Actions</a></li>
<li><a href="#progress-bar">Progress bar</a></li>
<li><a href="#volume-management">Volume management</a></li>
</ul>
</li>
</ul>
</div>
    
    <p><strong>Download documentation</strong></p>

<p>You can download the whole documentation in HTML format as</p>
<ul>
  <li><a href="https://github.com/tiliado/nuvolaplayer-developer-doc/archive/master.zip">Zip Archive</a></li>
  <li><a href="https://github.com/tiliado/nuvolaplayer-developer-doc">Git Repository</a></li>
</ul>

<p><strong>Get source</strong></p>
<p>
  This documentation is built from the
  <a href="https://github.com/tiliado/nuvolaplayer/tree/master/doc">doc directory</a>
  of the
  <a href="https://github.com/tiliado/nuvolaplayer">Nuvola Player repository</a>.
</p>
    <span class="backtotop"><a href="#top">↑ Back to top ↑</a></span>
  </div>
  <div class="col-sm-12 col-md-10 col-lg-9">
    
<p>Historically, Nuvola Apps Runtime (previously known as Nuvola Player) has a great support for media players and
offers a high level API for Media Player Integration.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>Before continuing, make sure you are familiar with following topics:</p>
<ul>
<li><a href="tutorial.html">Service Integration Tutorial</a>: Generic information how to set up Nuvola ADK, create a basic skeleton of your
    script and open web inspector tools.</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model">Document Object Model</a>: Methods how to extract metadata from a web page, e.g.
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/document.getElementById">document.getElementById</a>,
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document.getElementsByName">document.getElementsByName</a>,
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/document.getElementsByClassName">document.getElementsByClassName</a>,
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/document.getElementsByTagName">document.getElementsByTagName</a>,
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/document.querySelector">document.querySelector</a>,
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/document.querySelectorAll">document.querySelectorAll</a>.</li>
</ul>
<h2 id="metadata">Metadata</h2>
<p>Media player scripts generally contain these metadata:</p>
<ul>
<li><code>"categories": "AudioVideo;Audio;"</code> - for the launcher to be shown among audio &amp; video applications</li>
<li><code>"requirements": "Feature[Flash]"</code> - if your web app requires Flash plugin for media playback</li>
<li><code>"requirements": "Codec[MP3]"</code> - if your web app requires HTML5 Audio with MP3 codec for media playback</li>
</ul>
<h2 id="integration-script">Integration Script</h2>
<h3 id="media-player-skeleton">Media player skeleton</h3>
<p>Save the code bellow as a <code>integrate.js</code> file. It performs following actions:</p>
<ul>
<li>Creates new <code>Nuvola.MediaPlayer</code> component.</li>
<li>Creates new <code>WebApp</code> object.</li>
<li>Initializes WebWorker process to call <code>_onPageReady</code> callback when page is loaded.</li>
<li>Creates <code>update()</code> loop.</li>
<li>Connect handler for actions.</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="s2">"use strict"</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">Nuvola</span><span class="p">)</span>
<span class="p">{</span>

<span class="c1">// Create media player component</span>
<span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">$object</span><span class="p">(</span><span class="nx">Nuvola</span><span class="p">.</span><span class="nx">MediaPlayer</span><span class="p">);</span>

<span class="c1">// Handy aliases</span>
<span class="kd">var</span> <span class="nx">PlaybackState</span> <span class="o">=</span> <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">PlaybackState</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">PlayerAction</span> <span class="o">=</span> <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">PlayerAction</span><span class="p">;</span>

<span class="c1">// Create new WebApp prototype</span>
<span class="kd">var</span> <span class="nx">WebApp</span> <span class="o">=</span> <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">$WebApp</span><span class="p">();</span>

<span class="c1">// Initialization routines</span>
<span class="nx">WebApp</span><span class="p">.</span><span class="nx">_onInitWebWorker</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">emitter</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">WebApp</span><span class="p">.</span><span class="nx">_onInitWebWorker</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">emitter</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">state</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">readyState</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">state</span> <span class="o">===</span> <span class="s2">"interactive"</span> <span class="o">||</span> <span class="nx">state</span> <span class="o">===</span> <span class="s2">"complete"</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_onPageReady</span><span class="p">();</span>
    <span class="k">else</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"DOMContentLoaded"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onPageReady</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// Page is ready for magic</span>
<span class="nx">WebApp</span><span class="p">.</span><span class="nx">_onPageReady</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Connect handler for signal ActionActivated</span>
    <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s2">"ActionActivated"</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="c1">// Start update routine</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Extract data from the web page</span>
<span class="nx">WebApp</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="c1">// Schedule the next update</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">500</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Handler of playback actions</span>
<span class="nx">WebApp</span><span class="p">.</span><span class="nx">_onActionActivated</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">emitter</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">param</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="nx">WebApp</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>

<span class="p">})(</span><span class="k">this</span><span class="p">);</span>  <span class="c1">// function(Nuvola)</span>
</pre></div>
</td></tr></table>
<h3 id="playback-state">Playback state</h3>
<p>Looking at the code of a web page shown in the picture bellow, the code to extract playback state
might be. Playback states are defined in an enumeration
<a href="./api_reference.html#Nuvola.PlaybackState">Nuvola.PlaybackState</a> and set by method
<a href="./api_reference.html#Nuvola.MediaPlayer.setPlaybackState">player.setPlaybackState()</a>.</p>
<div class="codehilite"><pre><span></span><span class="p">...</span>
<span class="kd">var</span> <span class="nx">PlaybackState</span> <span class="o">=</span> <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">PlaybackState</span><span class="p">;</span>
<span class="p">...</span>

<span class="nx">WebApp</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">...</span>

    <span class="k">try</span>
    <span class="p">{</span>
        <span class="k">switch</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"status"</span><span class="p">).</span><span class="nx">innerText</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">case</span> <span class="s2">"Playing"</span><span class="o">:</span>
                <span class="kd">var</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">PlaybackState</span><span class="p">.</span><span class="nx">PLAYING</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">"Paused"</span><span class="o">:</span>
                <span class="kd">var</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">PlaybackState</span><span class="p">.</span><span class="nx">PAUSED</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="kd">var</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">PlaybackState</span><span class="p">.</span><span class="nx">UNKNOWN</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Always expect errors, e.g. document.getElementById("status") might be null</span>
        <span class="kd">var</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">PlaybackState</span><span class="p">.</span><span class="nx">UNKNOWN</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">player</span><span class="p">.</span><span class="nx">setPlaybackState</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>

    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
<p><img alt="Playback state" src="../images/guide/playback_state.png"/></p>
<h3 id="track-details">Track details</h3>
<p>Similarly, we can obtain track details and pass them to method <a href="./api_reference.html#Nuvola.MediaPlayer.setTrack">player.setTrack()</a></p>
<div class="codehilite"><pre><span></span><span class="nx">WebApp</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">...</span>

    <span class="kd">var</span> <span class="nx">track</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">artLocation</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="c1">// always null</span>
        <span class="nx">rating</span><span class="o">:</span> <span class="kc">null</span> <span class="c1">// same</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">idMap</span> <span class="o">=</span> <span class="p">{</span><span class="nx">title</span><span class="o">:</span> <span class="s2">"track"</span><span class="p">,</span> <span class="nx">artist</span><span class="o">:</span> <span class="s2">"artist"</span><span class="p">,</span> <span class="nx">album</span><span class="o">:</span> <span class="s2">"album"</span><span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">idMap</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="nx">track</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">idMap</span><span class="p">[</span><span class="nx">key</span><span class="p">]).</span><span class="nx">innerText</span> <span class="o">||</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Always expect errors, e.g. document.getElementById() might return null</span>
            <span class="nx">track</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">player</span><span class="p">.</span><span class="nx">setTrack</span><span class="p">(</span><span class="nx">track</span><span class="p">);</span>

    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
<p><img alt="Track details" src="../images/guide/track_details.png"/></p>
<h3 id="media-player-actions">Media Player Actions</h3>
<p>The second responsibility of a service integration is to <strong>manage media player actions</strong>:</p>
<ol>
<li>Set which actions are enabled.</li>
<li>Invoke the actions when they are activated.</li>
</ol>
<p>The first part is done via calls <a href="./api_reference.html#Nuvola.MediaPlayer.setCanPause">player.setCanPause()</a>,
<a href="./api_reference.html#Nuvola.MediaPlayer.setCanPlay">player.setCanPlay()</a>,
<a href="./api_reference.html#Nuvola.MediaPlayer.setCanGoPrev">player.setCanGoPrev()</a> and
<a href="./api_reference.html#Nuvola.MediaPlayer.setCanGoNext">player.setCanGoNext()</a>:</p>
<div class="codehilite"><pre><span></span><span class="nx">WebApp</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">...</span>

    <span class="kd">var</span> <span class="nx">enabled</span><span class="p">;</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="nx">enabled</span> <span class="o">=</span> <span class="o">!</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"prev"</span><span class="p">).</span><span class="nx">disabled</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">player</span><span class="p">.</span><span class="nx">setCanGoPrev</span><span class="p">(</span><span class="nx">enabled</span><span class="p">);</span>

    <span class="k">try</span>
    <span class="p">{</span>
        <span class="nx">enabled</span>  <span class="o">=</span> <span class="o">!</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"next"</span><span class="p">).</span><span class="nx">disabled</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">player</span><span class="p">.</span><span class="nx">setCanGoNext</span><span class="p">(</span><span class="nx">enabled</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">playPause</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"pp"</span><span class="p">);</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="nx">enabled</span>  <span class="o">=</span> <span class="nx">playPause</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">==</span> <span class="s2">"Play"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">player</span><span class="p">.</span><span class="nx">setCanPlay</span><span class="p">(</span><span class="nx">enabled</span><span class="p">);</span>

    <span class="k">try</span>
    <span class="p">{</span>
        <span class="nx">enabled</span>  <span class="o">=</span> <span class="nx">playPause</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">==</span> <span class="s2">"Pause"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">player</span><span class="p">.</span><span class="nx">setCanPause</span><span class="p">(</span><span class="nx">enabled</span><span class="p">);</span>

    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
<p><img alt="Playback actions" src="../images/guide/playback_actions.png"/></p>
<p>To handle playback actions defined in an enumeration <a href="./api_reference.html#Nuvola.PlayerAction">PlayerAction</a>,
it is necessary to connect to <a href="./api_reference.html#Nuvola.Actions%3A%3AActionActivated">Actions::ActionActivated signal</a>.
You can use a convenient function <a href="./api_reference.html#Nuvola.clickOnElement">Nuvola.clickOnElement()</a> to
simulate clicking.</p>
<div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">PlayerAction</span> <span class="o">=</span> <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">PlayerAction</span><span class="p">;</span>

<span class="p">...</span>

<span class="nx">WebApp</span><span class="p">.</span><span class="nx">_onPageReady</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Connect handler for signal ActionActivated</span>
    <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s2">"ActionActivated"</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="c1">// Start update routine</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
<span class="p">}</span>

<span class="p">...</span>

<span class="nx">WebApp</span><span class="p">.</span><span class="nx">_onActionActivated</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">emitter</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">param</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="nx">PlayerAction</span><span class="p">.</span><span class="nx">TOGGLE_PLAY</span><span class="o">:</span>
    <span class="k">case</span> <span class="nx">PlayerAction</span><span class="p">.</span><span class="nx">PLAY</span><span class="o">:</span>
    <span class="k">case</span> <span class="nx">PlayerAction</span><span class="p">.</span><span class="nx">PAUSE</span><span class="o">:</span>
    <span class="k">case</span> <span class="nx">PlayerAction</span><span class="p">.</span><span class="nx">STOP</span><span class="o">:</span>
        <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">clickOnElement</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"pp"</span><span class="p">));</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">PlayerAction</span><span class="p">.</span><span class="nx">PREV_SONG</span><span class="o">:</span>
        <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">clickOnElement</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"prev"</span><span class="p">));</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">PlayerAction</span><span class="p">.</span><span class="nx">NEXT_SONG</span><span class="o">:</span>
        <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">clickOnElement</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"next"</span><span class="p">));</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<div class="panel panel-danger"><p class="panel-heading">Always test playback actions</p><div class="panel-body">
<p>You should click action buttons in the developer's sidebar to be sure they are working as expected.</p>
</div></div>
<div class="panel panel-info"><p class="panel-heading">Custom actions</p><div class="panel-body">
<p>Service integrations can also create <a href="../apps/custom-actions.html">custom Actions</a> like thumbs
up/down or star rating.</p>
</div></div>
<h3 id="progress-bar">Progress bar</h3>
<p>Since <strong>Nuvola 4.5</strong>, it is also possible to integrate progress bar. If you wish to make your script compatible with
older versions, use respective <a href="./api_reference.html#Nuvola.checkVersion">Nuvola.checkVersion</a> condition as shown in examples bellow.</p>
<p>In order to extract track length and position, use these API calls:</p>
<ul>
<li><a href="./api_reference.html#Nuvola.MediaPlayer.setTrack">MediaPlayer.setTrack</a> supports <code>track.length</code> property, which holds track
    length either as a string "mm:ss" or number of microseconds. This property is ignored in Nuvola &lt; 4.5.</li>
<li><a href="./api_reference.html#Nuvola.MediaPlayer.setTrackPosition">MediaPlayer.setTrackPosition</a> is used to update track position.
    This method is not available in Nuvola &lt; 4.5 and results in error.</li>
<li><a href="./api_reference.html#Nuvola.parseTimeUsec">Nuvola.parseTimeUsec</a> (in Nuvola &gt;= 4.5) can be used to convert track length string (e.g. "2:35")
    into the number of microseconds. <a href="./api_reference.html#Nuvola.MediaPlayer.setTrack">MediaPlayer.setTrack</a> does that automatically
    for the <code>track.length</code> property.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="nx">WebApp</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">...</span>

    <span class="c1">// @API 4.5: track.length ignored in Nuvola &lt; 4.5</span>
    <span class="kd">var</span> <span class="nx">elm</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"timetotal"</span><span class="p">);</span>
    <span class="nx">track</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">elm</span> <span class="o">?</span> <span class="nx">elm</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">||</span> <span class="kc">null</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nx">player</span><span class="p">.</span><span class="nx">setTrack</span><span class="p">(</span><span class="nx">track</span><span class="p">);</span>

    <span class="p">...</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">Nuvola</span><span class="p">.</span><span class="nx">checkVersion</span> <span class="o">&amp;&amp;</span> <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">checkVersion</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>  <span class="c1">// @API 4.5</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">elm</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"timeelapsed"</span><span class="p">);</span>
        <span class="nx">player</span><span class="p">.</span><span class="nx">setTrackPosition</span><span class="p">(</span><span class="nx">elm</span> <span class="o">?</span> <span class="nx">elm</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">||</span> <span class="kc">null</span> <span class="o">:</span> <span class="kc">null</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
<p>If you wish to let user change track position, use this API:</p>
<ul>
<li><a href="./api_reference.html#Nuvola.MediaPlayer.setCanSeek">MediaPlayer.setCanSeek</a> is used to enable/disable remote seek.
    This method is not available in Nuvola &lt; 4.5 and results in error.</li>
<li>Then the <a href="./api_reference.html#Nuvola.PlayerAction">PlayerAction.SEEK</a> is emitted whenever a remote seek is requested.
    The action parameter contains a track position in microseconds. <code>PlayerAction.SEEK</code> is undefined in
    Nuvola &lt; 4.5 and the handler is never executed.</li>
<li>You may need to use <a href="./api_reference.html#Nuvola.clickOnElement">Nuvola.clickOnElement</a> with coordinates to trigger a click
    event at the position of progress bar corresponding to the track position,
    e.g. <code>Nuvola.clickOnElement(progressBar, param/Nuvola.parseTimeUsec(trackLength), 0.5)</code>.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="nx">WebApp</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">Nuvola</span><span class="p">.</span><span class="nx">checkVersion</span> <span class="o">&amp;&amp;</span> <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">checkVersion</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>  <span class="c1">// @API 4.5</span>
    <span class="p">{</span>
        <span class="nx">player</span><span class="p">.</span><span class="nx">setCanSeek</span><span class="p">(</span><span class="nx">state</span> <span class="o">!==</span> <span class="nx">PlaybackState</span><span class="p">.</span><span class="nx">UNKNOWN</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="p">...</span>

<span class="nx">WebApp</span><span class="p">.</span><span class="nx">_onActionActivated</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">emitter</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">param</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">...</span>
    <span class="k">case</span> <span class="nx">PlayerAction</span><span class="p">.</span><span class="nx">SEEK</span><span class="o">:</span>  <span class="c1">// @API 4.5: undefined &amp; ignored in Nuvola &lt; 4.5</span>
        <span class="kd">var</span> <span class="nx">elm</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"timetotal"</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">total</span> <span class="o">=</span> <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">parseTimeUsec</span><span class="p">(</span><span class="nx">elm</span> <span class="o">?</span> <span class="nx">elm</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">:</span> <span class="kc">null</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">param</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">param</span> <span class="o">&lt;=</span> <span class="nx">total</span><span class="p">)</span>
            <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">clickOnElement</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"progresstext"</span><span class="p">),</span> <span class="nx">param</span><span class="o">/</span><span class="nx">total</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="p">...</span>
</pre></div>
<p><img alt="Playback time" src="../images/guide/progress_bar.png"/></p>
<h3 id="volume-management">Volume management</h3>
<p>Since <strong>Nuvola 4.5</strong>, it is also possible to integrate volume management. If you wish to make your script compatible with
older versions, use respective <a href="./api_reference.html#Nuvola.checkVersion">Nuvola.checkVersion</a> condition as shown in examples bellow.</p>
<p>In order to extract volume, use <a href="./api_reference.html#Nuvola.MediaPlayer.updateVolume">MediaPlayer.updateVolume</a> with the parameter
in range 0.0-1.0 (i.e. 0-100%). This method is not available in Nuvola &lt; 4.5 and results in error.</p>
<div class="codehilite"><pre><span></span><span class="nx">WebApp</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">...</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">Nuvola</span><span class="p">.</span><span class="nx">checkVersion</span> <span class="o">&amp;&amp;</span> <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">checkVersion</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>  <span class="c1">// @API 4.5</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">elm</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"volume"</span><span class="p">);</span>
        <span class="nx">player</span><span class="p">.</span><span class="nx">updateVolume</span><span class="p">(</span><span class="nx">elm</span> <span class="o">?</span> <span class="nx">elm</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">||</span> <span class="kc">null</span> <span class="o">:</span> <span class="kc">null</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
<p>If you wish to let user change volume, use this API:</p>
<ul>
<li><a href="./api_reference.html#Nuvola.MediaPlayer.setCanChangeVolume">MediaPlayer.setCanChangeVolume</a> is used to enable/disable remote
    volume managementThis method is not available in Nuvola &lt; 4.5 and results in error.</li>
<li>Then the <a href="./api_reference.html#Nuvola.PlayerAction">PlayerAction.CHANGE_VOLUME</a> is emitted whenever a remote volume change
    requested. The action parameter contains new volume as a double value in range 0.0-1.0.
    <code>PlayerAction.CHANGE_VOLUME</code> is undefined in Nuvola &lt; 4.5 and the handler is never executed.</li>
<li>You may need to use <a href="./api_reference.html#Nuvola.clickOnElement">Nuvola.clickOnElement</a> with coordinates to trigger a click
    event at the position of volume bar corresponding to the desired volume,
    e.g. <code>Nuvola.clickOnElement(volumeBar, param, 0.5)</code>.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="nx">WebApp</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">Nuvola</span><span class="p">.</span><span class="nx">checkVersion</span> <span class="o">&amp;&amp;</span> <span class="nx">Nuvola</span><span class="p">.</span><span class="nx">checkVersion</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>  <span class="c1">// @API 4.5</span>
    <span class="p">{</span>
        <span class="nx">player</span><span class="p">.</span><span class="nx">setCanChangeVolume</span><span class="p">(</span><span class="nx">state</span> <span class="o">!==</span> <span class="nx">PlaybackState</span><span class="p">.</span><span class="nx">UNKNOWN</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="p">...</span>

<span class="nx">WebApp</span><span class="p">.</span><span class="nx">_onActionActivated</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">emitter</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">param</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">...</span>
    <span class="k">case</span> <span class="nx">PlayerAction</span><span class="p">.</span><span class="nx">CHANGE_VOLUME</span><span class="o">:</span>  <span class="c1">// @API 4.5: undefined &amp; ignored in Nuvola &lt; 4.5</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"volume"</span><span class="p">).</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">param</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="p">...</span>
</pre></div>
<p><img alt="Playback volume" src="../images/guide/volume_management.png"/></p>
    <div class="footer">
  <hr />
  <div class="panel panel-primary">
    <p class="panel-heading">
      Questions? Feedback?
    </p>
    <div class="panel-body">
      <p>
        Having trouble? We'd like to help!
      </p>
      <ul>
        <li>Search for information in the archives of
          <a href="https://groups.google.com/d/forum/nuvola-player-devel">the nuvola-player-devel
          mailing list</a>, or post a question.
        </li>
        <li>
          If you notice errors with this documentation, please
          <a href="https://github.com/tiliado/nuvolaplayer/issues">open a ticket and let us
          know</a>! Please only use the ticket tracker for criticisms and improvements on the docs.
        </li>
      </ul>
    </div>
  </div>
  <hr />
  <p class="text-center">
    Generated by <a href="http://getpelican.com/">Pelican</a>.
    Get <a href="https://github.com/tiliado/nuvolaplayer/tree/master/doc">source code</a>.
    Uses <a href="http://getbootstrap.com/">Bootstrap</a> theme
    <a href="http://bootswatch.com/united/">United</a>.
  </p>
</div>
  </div> 

      </div>
    </div>
  </body>
</html>
